# SYNOPSIS:
#
#   make [all]  - makes everything.
#   make TARGET - makes the given target.
#   make clean  - removes all files generated by make.

PRI_DIRS := stub test

SUB_DIRS := $(shell find . -maxdepth 1 -type d)
SUB_DIRS := $(basename $(patsubst ./%,%,$(SUB_DIRS)))
SUB_DIRS := $(filter-out $(PRI_DIRS),$(SUB_DIRS))
SUB_DIRS := $(PRI_DIRS) $(SUB_DIRS)

all: $(SUB_DIRS)

.PHONY: $(SUB_DIRS)
$(SUB_DIRS):
	$(MAKE) -C $@

CLEAN_DIRS := $(addprefix _clean_,$(SUB_DIRS) )

$(CLEAN_DIRS):
	$(MAKE) -C $(patsubst _clean_%,%,$@) clean

clean: $(CLEAN_DIRS)
	cd ..; find . -type f -name '*wrap.cxx' -exec rm -f {} \;